<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>FHIR Patient 上傳範例</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }
    label {
      display: block;
      margin-top: 12px;
    }
    input, select, button {
      margin-top: 6px;
      padding: 6px;
      width: 300px;
    }
    button {
      margin-top: 16px;
      width: 150px;
    }
    pre {
      background: #f5f5f5;
      padding: 12px;
      margin-top: 20px;
      border: 1px solid #ccc;
      max-height: 400px;
      overflow: auto;
    }
  </style>
</head>
<body>

<h2>FHIR Patient 上傳（HAPI FHIR R4）</h2>

<label>
  姓（Family Name）：
  <input type="text" id="family" placeholder="例如：Hsiao">
</label>

<label>
  名（Given Name）：
  <input type="text" id="given" placeholder="例如：Jack">
</label>

<label>
  性別：
  <select id="gender">
    <option value="">-- 請選擇 --</option>
    <option value="male">男性 (male)</option>
    <option value="female">女性 (female)</option>
    <option value="other">其他 (other)</option>
    <option value="unknown">未知 (unknown)</option>
  </select>
</label>

<label>
  生日：
  <input type="date" id="birthDate">
</label>

<button onclick="uploadPatient()">上傳 Patient</button>

<h3>FHIR Server 回應結果</h3>
<pre id="result">(尚未送出)</pre>

<script>
async function uploadPatient() {
  const family = document.getElementById("family").value.trim();
  const given = document.getElementById("given").value.trim();
  const gender = document.getElementById("gender").value;
  const birthDate = document.getElementById("birthDate").value;

  if (!family || !given || !gender || !birthDate) {
    alert("請完整輸入 姓名、性別、生日");
    return;
  }

  // FHIR Patient Resource
  const patient = {
    resourceType: "Patient",
    name: [
      {
        use: "official",
        family: family,
        given: [given]
      }
    ],
    gender: gender,
    birthDate: birthDate
  };

  const resultEl = document.getElementById("result");
  resultEl.textContent = "上傳中...";

  try {
    const response = await fetch(
      "https://hapi.fhir.org/baseR4/Patient",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/fhir+json"
        },
        body: JSON.stringify(patient)
      }
    );

    const data = await response.json();

    resultEl.textContent =
      "HTTP Status: " + response.status + "\n\n" +
      JSON.stringify(data, null, 2);

  } catch (error) {
    resultEl.textContent = "發生錯誤：\n" + error;
  }
}
</script>

</body>
</html>
